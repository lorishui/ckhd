<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="me.ckhd.opengame.stats.dao.UserFlowDao">
	
	<select id="getCountByChannel" resultType="UserFlow">
		SELECT 
		  a.ckAppId,
		  a.childCkAppId,
		  b.channelId AS fromChannel,
		  a.ckChannelId AS toChannel,
		  COUNT(0) AS num,
		  sum(a.actualAmount) AS totalMoney
		FROM app_online_pay a 
		LEFT JOIN app_device_info b ON (
		      a.ckAppId = a.ckAppId 
		      AND a.deviceId = b.deviceId 
		      AND a.channelId <![CDATA[<>]]> b.ckChannelId
		    ) 
		WHERE a.create_date BETWEEN #{startTime} AND #{endTime}
		 <if test="ckAppId != null and ckAppId != ''">
		  AND a.ckAppId = #{ckAppId} 
		  AND b.ckAppId = #{ckAppId} 
		 </if> 
		GROUP BY a.ckAppId,a.childCkAppId,a.channelId 
	</select>
	
</mapper>