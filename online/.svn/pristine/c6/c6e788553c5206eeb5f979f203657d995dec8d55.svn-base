<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="me.ckhd.opengame.buyflow.dao.BuyFlowTotalIncomeStatsDao">

	<select id="queryTotalIncome" resultType="java.util.HashMap">
    <![CDATA[
        SELECT CONCAT(ckapp_id, '_', child_ckapp_id, '_', media, '_', ad_item, '_',
        stats_date) AS `key`,
        sum(CASE WHEN days = 0 THEN income ELSE 0 END) as totalIncome0,
        sum(CASE WHEN days <= 1 THEN income ELSE 0 END) as totalIncome1,
        sum(CASE WHEN days <= 7 THEN income ELSE 0 END) as totalIncome7,
        sum(CASE WHEN days <= 30 THEN income ELSE 0 END) as totalIncome30,
        sum(CASE WHEN days <= 60 THEN income ELSE 0 END) as totalIncome60
        FROM buy_flow_total_income_stats
        WHERE stats_date >= #{startDate} AND stats_date <= #{endDate} group by
        ckapp_id,child_ckapp_id,media,ad_item,stats_date;
        ]]>
	</select>
</mapper>