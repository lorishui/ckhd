package me.ckhd.opengame.online.handle;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import me.ckhd.opengame.app.entity.PayInfoConfig;
import me.ckhd.opengame.common.utils.StringUtils;
import me.ckhd.opengame.online.entity.OnlinePay;
import me.ckhd.opengame.online.entity.OnlineUser;
import me.ckhd.opengame.util.HttpClientUtils;

import org.springframework.stereotype.Component;

import com.alibaba.fastjson.JSONObject;

@Component("sougo")
public class sougoHandle extends BaseHandle{
	
	private static final String login_test_url = "http://dev.sdk.g.sogou.com/api/v2/login/verify";
	private static final String login_url = "http://gamesdk.sogou.com/api/v2/login/verify";
	
	@Override
	public String login(OnlineUser onlineUser, JSONObject codeJson,
			PayInfoConfig payInfo) {
		JSONObject result = new JSONObject();
		result.put("resultCode", -1);
		JSONObject verifyInfo = codeJson.getJSONObject("verifyInfo");
		onlineUser.setSid(verifyInfo.getString("userId"));
		String url = login_url;
		if( codeJson.containsKey("isTest") && 1 == codeJson.getInteger("isTest") ){
			url = login_test_url;
		}
		String respStr = HttpClientUtils.post(url, "gid="+payInfo.getCkAppId()+"&userId="+verifyInfo.getString("userId")
				+"&sessionKey="+verifyInfo.getString("sessionKey")+"&auth="+verifyInfo.getString("auth"), 10000, 10000);
		if( StringUtils.isNotBlank(respStr) ){
			JSONObject respJson = JSONObject.parseObject(respStr);
			if( respJson.containsKey("code") && 0 == respJson.getInteger("code") ){
				returnLoginSuccess(result, onlineUser);
			}else{
				result.put("errMsg", "用户验证失败！");
			}
		}else{
			result.put("errMsg", "数据为空或者请求失败！");
		}
		return result.toJSONString();
	}

	@Override
	public void parseParamter(String code, HttpServletRequest request,
			OnlinePay onlinePay) {
		
	}

	@Override
	public String verifyData(OnlinePay onlinePay, JSONObject result,
			HttpServletResponse response) {
		return null;
	}

	@Override
	public String getReturnSuccess() {
		return null;
	}

	@Override
	public String getReturnFailure() {
		return null;
	}

}
