<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="me.ckhd.opengame.stats.dao.StatRetentionDao">
	
	<select id="statsData" resultType="StatRetention">
		SELECT
		  regTime,
			sum(IF(retentionDay = 1, num, 0)) AS d1NUm,
			sum(IF(retentionDay = 2, num, 0)) AS d2NUm,
			sum(IF(retentionDay = 3, num, 0)) AS d3NUm,
			sum(IF(retentionDay = 4, num, 0)) AS d4NUm,
			sum(IF(retentionDay = 5, num, 0)) AS d5NUm,
			sum(IF(retentionDay = 6, num, 0)) AS d6NUm,
			sum(IF(retentionDay = 7, num, 0)) AS d7NUm,
			sum(IF(retentionDay = 14, num, 0)) AS d14NUm,
			sum(IF(retentionDay = 30, num, 0)) AS d30NUm
		FROM count_retention_device
		where regTime >= '${startTime}' and regTime<![CDATA[<=]]>'${endTime}'
		<if test="ckAppId != null and ckAppId != ''">
			and ckAppId = #{ckAppId}
		</if>
		<if test="childCkAppId != null and childCkAppId != ''">
			and childCkAppId = #{childCkAppId}
		</if>
		<if test="ckChannelId != null and ckChannelId != ''">
			and ckChannelId = #{ckChannelId}
		</if>
		<if test="childChannelId != null and childChannelId != ''">
			and childChannelId = #{childChannelId}
		</if>
			group by regTime
	</select>
	
	
</mapper>