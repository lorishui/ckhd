<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="me.ckhd.opengame.app.dao.ChannelCarriersDao">
    <sql id="ChannelCarriersColumns">
    	a.id,
    	a.channel_id,
		b.name,
		a.carriers_type,
		c.label  AS  "carriersName",
		a.carriers_channelid  AS  "carriersChannelId",
		a.create_by AS "createBy.id",
		a.create_date,
		a.update_by AS "updateBy.id",
		a.update_date,
		a.del_flag,
		a.remarks
		
    </sql>
    
    <sql id="ChannelCarriersJoins">
        <!-- join other tables.-->
        JOIN channel b ON b.id = a.channel_id
        LEFT JOIN sys_dict c  ON c.type = 'carriers' and  c.value = a.carriers_type
        
    </sql>
	
	<!-- 根据id获得运营商渠道信息 -->
	<select id="get" resultType="ChannelCarriers">
		SELECT
			<include refid="ChannelCarriersColumns"/> 
		FROM channel_carriers a
		    <include refid="ChannelCarriersJoins"/> 
		WHERE a.id = #{id}
	</select>
	
	<!-- 根据名称查询运营商渠道 -->
	<select id="getByName" resultType="ChannelCarriers" parameterType="ChannelCarriers">
		SELECT
			<include refid="ChannelCarriersColumns"/> 
		FROM  channel_carriers a
			<include refid="ChannelCarriersJoins"/> 
		WHERE b.name = #{name} AND a.del_flag = #{DEL_FLAG_NORMAL}
	</select>
	
	
	<!-- 根据渠道号和运营商标识查询运营商渠道 -->
	<select id="getByChannelIdAndCarriersType" resultType="ChannelCarriers"  parameterType="ChannelCarriers">
		SELECT
			<include refid="ChannelCarriersColumns"/> 
		FROM  channel_carriers a
			<include refid="ChannelCarriersJoins"/> 
		WHERE 
		a.channel_id = #{channelId}     AND 
		a.carriers_type = #{carriersType} AND 
		a.del_flag = #{DEL_FLAG_NORMAL}
	</select>
	
	
	<!-- 分页查询渠道信息 -->
	<select id="findList" resultType="ChannelCarriers">
		SELECT
			<include refid="ChannelCarriersColumns"/>
		FROM  channel_carriers a
			<include refid="ChannelCarriersJoins"/> 
		WHERE a.del_flag = #{DEL_FLAG_NORMAL}
		<if test="channelId != null and channelId != ''">
			AND a.channel_id like   #{channelId} 
		</if>
		
		<if test="carriersChannelId != null and carriersChannelId != ''">
			AND a.carriers_channelid like  #{carriersChannelId} 
		</if>
		<if test="name != null and name != ''">
			AND b.name like CONCAT('%', #{name}, '%')
		</if>
		<if test="carriersType != null and carriersType != ''">
			AND (a.carriers_type like CONCAT('%', #{carriersType}, '%')
			    or c.label like CONCAT('%', #{carriersType}, '%'))
		</if>
		<choose>
			<when test="page !=null and page.orderBy != null and page.orderBy != ''">
				ORDER BY ${page.orderBy}
			</when>
			<otherwise>
				ORDER BY b.name
			</otherwise>
		</choose>
	</select>
	
	<!-- 查询全部运营商渠道信息 -->
	<select id="findAllList" resultType="ChannelCarriers">
		SELECT
			<include refid="ChannelCarriersColumns"/>
		FROM  channel_carriers a
			<include refid="ChannelCarriersJoins"/> 
		WHERE a.del_flag = #{DEL_FLAG_NORMAL} 
	</select>
	
	<!-- 查询全部记录数目 -->
	<select id="findAllCount" resultType="long">
		SELECT
			COUNT(1)
		FROM  channel_carriers a
		WHERE a.del_flag = #{DEL_FLAG_NORMAL}
	</select>
	
	<!-- 插入运营商渠道信息 -->
	<insert id="insert">
		INSERT INTO channel_carriers(
			id, 
			channel_id,
			carriers_type,
			carriers_channelid,
			create_by,
			create_date,
			update_by,
			update_date,
			remarks, 
			del_flag
		) VALUES (
			#{id}, 
			#{channelId}, 
			#{carriersType}, 
			#{carriersChannelId}, 
			#{createBy.id}, 
			#{createDate}, 
			#{updateBy.id}, 
			#{updateDate}, 
			#{remarks}, 
			#{delFlag}
		)
	</insert>
	<!-- 更新运营商渠道信息-->
	<update id="update">
		UPDATE  channel_carriers SET 
			carriers_channelid = #{carriersChannelId}, 
			update_by = #{updateBy.id}, 
			update_date = #{updateDate}, 
			remarks = #{remarks}
		WHERE id = #{id}
	</update>
	
	<!-- 逻辑删除运营商渠道信息 -->
	<update id="delete">
		UPDATE  channel_carriers SET 
			del_flag = #{DEL_FLAG_DELETE}
		WHERE id = #{id}
	</update>
	
	<!-- 根据名称查询运营商渠道 -->
	<select id="getByCarriersChannelidAndCarriersType" resultType="ChannelCarriers" parameterType="ChannelCarriers">
		SELECT
			a.channel_id as channelId
		FROM  channel_carriers a
		WHERE a.carriers_channelid = #{carriersChannelId} AND a.del_flag = #{DEL_FLAG_NORMAL} AND carriers_type=#{carriersType}
	</select>
	
	<select id="findAllChannelOneType" resultType="ChannelCarriers" parameterType="ChannelCarriers">
		SELECT
			a.carriers_channelid as carriersChannelId,
			a.channel_id as channelId
		FROM  channel_carriers a
		WHERE a.del_flag='0' AND carriers_type=#{carriersType}
	</select>
</mapper>