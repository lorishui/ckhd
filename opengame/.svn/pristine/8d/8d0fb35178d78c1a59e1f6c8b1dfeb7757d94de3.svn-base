<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="me.ckhd.opengame.stats.dao.OfflineMoneyCountDao">
	<select id="stat" resultType="OfflineMoneyCount">
		SELECT
		  DATE_FORMAT(CONCAT(a.`timeframe`,'0000'),'${timeFt}') AS timeframe,
		  <if test="groupChannel != null and groupChannel == 1">
		  a.`ckChannelId`,
		  </if>
		  <if test="groupProvince != null and groupProvince == 1">
		  a.`province`,
		  </if>
		  <if test="groupCarriesChannel != null and groupCarriesChannel == 1">
		  a.`carriersChannelId`,
		  </if>
		  a.`ckAppId`,
		  SUM(a.`totalMoney`) AS totalMoney,
		  SUM(a.`successMoney`) AS successMoney,
		  SUM(a.`payNum`) AS payNum,
		  SUM(a.`payPeopleNum`) AS payPeopleNum,
		  SUM(a.`payPeopleSuccessNum`) AS payPeopleSuccessNum,
		  SUM(a.`paySuccessNum`) AS paySuccessNum
		FROM `offline_middle_count_mm` a 
		WHERE a.`timeframe` >= #{startTime}
		AND a.`timeframe` <![CDATA[<=]]> #{endTime}
		<if test="ckAppId != null and ckAppId != ''">
		  AND a.ckAppId = #{ckAppId}
		</if>
		<if test="ckChannelId != null and ckChannelId != ''">
		  AND a.ckChannelId = #{ckChannelId}
		</if>
		<if test="province != null and province != ''">
		  AND a.`province` =#{province}
		</if>
		GROUP BY a.`ckAppId`
		<if test="timeType != null and timeType != ''">
		  ,a.timeframe
		</if>
		<if test="groupChannel != null and groupChannel == 1">
		  ,a.`ckChannelId`
		</if>
		<if test="groupProvince != null and groupProvince == 1">
		  ,a.`province`
		</if>
		<if test="groupCarriesChannel != null and groupCarriesChannel == 1">
		  ,a.`carriersChannelId`
		</if>
	</select>
	
	<select id="statHour" resultType="OfflineMoneyCount">
		SELECT
		  a.timeframe,
		  <if test="groupChannel != null and groupChannel == 1">
		  a.`ckChannelId`,
		  </if>
		  <if test="groupProvince != null and groupProvince == 1">
		  a.`province`,
		  </if>
		  <if test="groupCarriesChannel != null and groupCarriesChannel == 1">
		  a.`carriersChannelId`,
		  </if>
		  <if test="groupApp != null and groupApp != 1">
		  a.`ckAppId`,
		  </if>
		  SUM(a.`totalMoney`) AS totalMoney,
		  SUM(a.`successMoney`) AS successMoney,
		  SUM(a.`payNum`) AS payNum,
		  SUM(a.`payPeopleNum`) AS payPeopleNum,
		  SUM(a.`payPeopleSuccessNum`) AS payPeopleSuccessNum,
		  SUM(a.`paySuccessNum`) AS paySuccessNum
		FROM `offline_middle_count_mm` a 
		WHERE a.`timeframe` >= #{startTime}
		AND a.`timeframe` <![CDATA[<=]]> #{endTime}
		<if test="ckAppId != null and ckAppId != ''">
		  AND a.ckAppId = #{ckAppId}
		</if>
		<if test="ckChannelId != null and ckChannelId != ''">
		  AND a.ckChannelId = #{ckChannelId}
		</if>
		<if test="province != null and province != ''">
		  AND a.`province` =#{province}
		</if>
		GROUP BY a.timeframe
		<if test="groupApp != null and groupApp != ''">
		  ,a.ckAppId
		</if>
		<if test="groupChannel != null and groupChannel == 1">
		  ,a.`ckChannelId`
		</if>
		<if test="groupProvince != null and groupProvince == 1">
		  ,a.`province`
		</if>
		<if test="groupCarriesChannel != null and groupCarriesChannel == 1">
		  ,a.`carriersChannelId`
		</if>
	</select>
	
	<select id="statMoeny" resultType="OfflineMoneyCount">
		SELECT
		  DATE_FORMAT(CONCAT(a.`timeframe`,'0000'),'${timeFt}') AS timeframes,
		  a.`ckAppId`,
		  SUM(a.`totalMoney`) AS totalMoney,
		  SUM(a.`successMoney`) AS successMoney,
		  SUM(a.`payNum`) AS payNum,
		  SUM(a.`payPeopleNum`) AS payPeopleNum,
		  SUM(a.`payPeopleSuccessNum`) AS payPeopleSuccessNum,
		  SUM(a.`paySuccessNum`) AS paySuccessNum
		FROM `offline_middle_count_${cType}` a 
		WHERE a.`timeframe` >= '${startTime}00'
		AND a.`timeframe` <![CDATA[<=]]> '${endTime}23'
		<if test="ckAppId != null and ckAppId != ''">
		  AND a.ckAppId = #{ckAppId}
		</if>
		<if test="ckChannelId != null and ckChannelId != ''">
		  AND a.ckChannelId = #{ckChannelId}
		</if>
		<if test="carriersChannelId != null and carriersChannelId != ''">
		  AND a.carriersChannelId = #{carriersChannelId}
		</if>
		<if test="province != null and province != ''">
		  AND a.`province` =#{province}
		</if> 
		GROUP BY timeframes
	</select>
	
	<insert id="saveDatas" >
		${sql}
	</insert>
	
	<select id="statTotalMoeny" resultType="OfflineMoneyCount">
		SELECT
		  SUM(a.`totalMoney`) AS totalMoney,
		  SUM(a.`successMoney`) AS successMoney,
		  SUM(a.`payNum`) AS payNum,
		  SUM(a.`payPeopleNum`) AS payPeopleNum,
		  SUM(a.`payPeopleSuccessNum`) AS payPeopleSuccessNum,
		  SUM(a.`paySuccessNum`) AS paySuccessNum
		FROM `offline_middle_count_${cType}` a 
		WHERE a.`timeframe` >= '${startTime}00'
		AND a.`timeframe` <![CDATA[<=]]> '${endTime}23'
		<if test="ckAppId != null and ckAppId != ''">
		  AND a.ckAppId = #{ckAppId}
		</if>
		<if test="ckChannelId != null and ckChannelId != ''">
		  AND a.ckChannelId = #{ckChannelId}
		</if>
		<if test="carriersChannelId != null and carriersChannelId != ''">
		  AND a.carriersChannelId = #{carriersChannelId}
		</if>
		<if test="province != null and province != ''">
		  AND a.`province` =#{province}
		</if> 
	</select>
	
	<select id="statTotalMoenyByHour" resultType="OfflineMoneyCount">
		SELECT
		  SUM(a.`totalMoney`) AS totalMoney,
		  SUM(a.`successMoney`) AS successMoney,
		  SUM(a.`payNum`) AS payNum,
		  SUM(a.`payPeopleNum`) AS payPeopleNum,
		  SUM(a.`payPeopleSuccessNum`) AS payPeopleSuccessNum,
		  SUM(a.`paySuccessNum`) AS paySuccessNum
		FROM `offline_middle_count_${cType}` a 
		WHERE a.`timeframe` >= '${startTime}'
		AND a.`timeframe` <![CDATA[<=]]> '${endTime}'
		<if test="ckAppId != null and ckAppId != ''">
		  AND a.ckAppId = #{ckAppId}
		</if>
		<if test="ckChannelId != null and ckChannelId != ''">
		  AND a.ckChannelId = #{ckChannelId}
		</if>
		<if test="carriersChannelId != null and carriersChannelId != ''">
		  AND a.carriersChannelId = #{carriersChannelId}
		</if>
		<if test="province != null and province != ''">
		  AND a.`province` =#{province}
		</if> 
	</select>
	
	<select id="statOfflineMoney" resultType="OfflineMoneyCount">
		select a.timeframes,
			sum(a.totalMoney) as totalMoney,
			SUM(a.successMoney)  as successMoney,
			SUM(a.payNum) as payNum,
			SUM(a.payPeopleNum) as payPeopleNum,
			SUM(a.payPeopleSuccessNum) as payPeopleSuccessNum,
			SUM(a.paySuccessNum) as payPeopleSuccessNum
		from(
			SELECT
			  DATE_FORMAT(CONCAT(a.`timeframe`,'0000'),'${timeFt}') AS timeframes,
			  SUM(a.`totalMoney`) AS totalMoney,
			  SUM(a.`successMoney`) AS successMoney,
			  SUM(a.`payNum`) AS payNum,
			  SUM(a.`payPeopleNum`) AS payPeopleNum,
			  SUM(a.`payPeopleSuccessNum`) AS payPeopleSuccessNum,
			  SUM(a.`paySuccessNum`) AS paySuccessNum
			FROM `offline_middle_count_mm` a 
			WHERE a.`timeframe` >= '${startTime}'
			AND a.`timeframe` <![CDATA[<=]]> '${endTime}'
			<if test="ckAppId != null and ckAppId != ''">
			  AND a.ckAppId = #{ckAppId}
			</if>
			<if test="ckChannelId != null and ckChannelId != ''">
			  AND a.ckChannelId = #{ckChannelId}
			</if>
			<if test="carriersChannelId != null and carriersChannelId != ''">
			  AND a.carriersChannelId = #{carriersChannelId}
			</if>
			<if test="province != null and province != ''">
			  AND a.`province` =#{province}
			</if> 
			GROUP BY timeframes
			union all
			SELECT
			  DATE_FORMAT(CONCAT(a.`timeframe`,'0000'),'${timeFt}') AS timeframes,
			  SUM(a.`totalMoney`) AS totalMoney,
			  SUM(a.`successMoney`) AS successMoney,
			  SUM(a.`payNum`) AS payNum,
			  SUM(a.`payPeopleNum`) AS payPeopleNum,
			  SUM(a.`payPeopleSuccessNum`) AS payPeopleSuccessNum,
			  SUM(a.`paySuccessNum`) AS paySuccessNum
			FROM `offline_middle_count_and` a 
			WHERE a.`timeframe` >= '${startTime}'
			AND a.`timeframe` <![CDATA[<=]]> '${endTime}'
			<if test="ckAppId != null and ckAppId != ''">
			  AND a.ckAppId = #{ckAppId}
			</if>
			<if test="ckChannelId != null and ckChannelId != ''">
			  AND a.ckChannelId = #{ckChannelId}
			</if>
			<if test="carriersChannelId != null and carriersChannelId != ''">
			  AND a.carriersChannelId = #{carriersChannelId}
			</if>
			<if test="province != null and province != ''">
			  AND a.`province` =#{province}
			</if> 
			GROUP BY timeframes
		) a group by a.timeframes
	</select>
	
	<select id="statTotalOfflineMoney" resultType="OfflineMoneyCount">
		select 
			sum(a.totalMoney) as totalMoney,
			SUM(a.successMoney)  as successMoney,
			SUM(a.payNum) as payNum,
			SUM(a.payPeopleNum) as payPeopleNum,
			SUM(a.payPeopleSuccessNum) as payPeopleSuccessNum,
			SUM(a.paySuccessNum) as payPeopleSuccessNum
		from(
			SELECT
			  SUM(a.`totalMoney`) AS totalMoney,
			  SUM(a.`successMoney`) AS successMoney,
			  SUM(a.`payNum`) AS payNum,
			  SUM(a.`payPeopleNum`) AS payPeopleNum,
			  SUM(a.`payPeopleSuccessNum`) AS payPeopleSuccessNum,
			  SUM(a.`paySuccessNum`) AS paySuccessNum
			FROM `offline_middle_count_mm` a 
			WHERE a.`timeframe` >= '${startTime}'
			AND a.`timeframe` <![CDATA[<=]]> '${endTime}'
			<if test="ckAppId != null and ckAppId != ''">
			  AND a.ckAppId = #{ckAppId}
			</if>
			<if test="ckChannelId != null and ckChannelId != ''">
			  AND a.ckChannelId = #{ckChannelId}
			</if>
			<if test="carriersChannelId != null and carriersChannelId != ''">
			  AND a.carriersChannelId = #{carriersChannelId}
			</if>
			<if test="province != null and province != ''">
			  AND a.`province` =#{province}
			</if> 
			union all
			SELECT
			  SUM(a.`totalMoney`) AS totalMoney,
			  SUM(a.`successMoney`) AS successMoney,
			  SUM(a.`payNum`) AS payNum,
			  SUM(a.`payPeopleNum`) AS payPeopleNum,
			  SUM(a.`payPeopleSuccessNum`) AS payPeopleSuccessNum,
			  SUM(a.`paySuccessNum`) AS paySuccessNum
			FROM `offline_middle_count_and` a 
			WHERE a.`timeframe` >= '${startTime}'
			AND a.`timeframe` <![CDATA[<=]]> '${endTime}'
			<if test="ckAppId != null and ckAppId != ''">
			  AND a.ckAppId = #{ckAppId}
			</if>
			<if test="ckChannelId != null and ckChannelId != ''">
			  AND a.ckChannelId = #{ckChannelId}
			</if>
			<if test="carriersChannelId != null and carriersChannelId != ''">
			  AND a.carriersChannelId = #{carriersChannelId}
			</if>
			<if test="province != null and province != ''">
			  AND a.`province` =#{province}
			</if> 
		) a 
	</select>
	
</mapper>