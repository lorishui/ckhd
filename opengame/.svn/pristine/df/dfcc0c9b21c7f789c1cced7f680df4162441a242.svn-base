<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="me.ckhd.opengame.game.dao.GiftCodeDao">
 
	<insert id="insert">
		INSERT INTO t_gift_code(
			ckAppId,
			ckChannelId,
			code,
			giftDescId,
			imei,
			isUse
		) VALUES (
			#{ckAppId},
			#{ckChannelId},
			#{code},
			#{giftDescId},
			#{imei},
			#{isUse}
		)
	</insert>
	<insert id="batchInsert">
		INSERT INTO t_gift_code(
			ckAppId,
			ckChannelId,
			code,
			giftDescId,
			isUse,
			createTime
		) VALUES
	<foreach item="data" collection="list" separator="," close=";" >
		(#{data.ckAppId},#{data.ckChannelId},#{data.code},#{data.giftDescId},#{data.isUse},#{data.createDate})
	</foreach>
	</insert>
	
	<!-- 分页查询信息 -->
	<select id="findList" resultType="GiftCode">
		SELECT a.`code`,a.`ckAppId`,a.`ckChannelId`,b.`startTime`,b.`endTime`,c.`name`,a.`imei`,a.`updateTime`
		FROM t_gift_code a
		LEFT JOIN t_gift_desc b ON (a.`giftDescId`=b.`id` and a.ckAppId=b.ckAppId)
		LEFT JOIN t_gift c ON (b.`giftId`=c.id and b.ckAppId=c.ckAppId)
		WHERE 1=1
		<if test="ckAppId != null and ckAppId != ''">
			AND a.ckAppid = #{ckAppId}
		</if>
		<if test="ckChannelId != null and ckChannelId != ''">
			AND a.ckChannelId = #{ckChannelId}
		</if>
		<if test="imei != null and imei != ''">
			AND a.imei like '%${imei}%'
		</if>
		<if test="code != null and code != ''">
			AND a.code like '%${code}%'
		</if>
		<choose>
			<when test="page !=null and page.orderBy != null and page.orderBy != ''">
				ORDER BY ${page.orderBy}
			</when>
			<otherwise>
				ORDER BY a.ckAppId,a.giftDescId,a.ckChannelId,a.createTime
			</otherwise>
		</choose>
	</select>
</mapper>