<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="me.ckhd.opengame.game.dao.GiftDao">
 
	<insert id="insert">
		INSERT INTO t_gift(
			id,
			ckAppId,
			name,
			goodsId,
			goodsNumber,
			parentNode
		) VALUES (
			#{newId},
			#{ckAppId},
			#{name},
			#{goodsId},
			#{goodsNumber},
			#{parentNode}
		)
	</insert>
	
	<update id="update">
		UPDATE	t_gift SET 
			id=#{newId}
			<if test="ckAppId != null and ckAppId != ''">
			,ckAppId=#{ckAppId}
			</if> 
			<if test="name != null and name != ''">
			,name=#{name}
			</if>
			<if test="goodsId != null and goodsId != ''">
			,goodsId=#{goodsId}
			</if>
			<if test="goodsNumber != null and goodsNumber != ''">
			,goodsNumber=#{goodsNumber}
			</if>
			<if test="parentNode != null and parentNode != ''">
			,parentNode=#{parentNode}
			</if>
		WHERE id = #{id} and ckAppId=#{ckAppId}
	</update>
	
	<update id="delete">
		DELETE FROM t_gift 
		WHERE ckAppId=#{ckAppId} and
		<if test="id != null and id != ''">
			id=#{id} 
		</if>
		<if test="parentNode != null and parentNode != ''">
			parentNode=#{parentNode} 
		</if>
	</update>
	
	
	<!-- 分页查询信息 -->
	<select id="findList" resultType="Gift">
		SELECT 
			a.`id`,
			a.`ckAppId`,
			a.`name`,
			GROUP_CONCAT(c.`name`,'*',b.`goodsNumber`) AS giftdesc
		FROM `t_gift` a
		LEFT JOIN t_gift b ON (a.`id`=b.`parentNode` AND a.`ckAppId`=b.`ckAppId`)
		LEFT JOIN t_goods c ON (b.`goodsId`=c.id AND b.`ckAppId`=c.`ckAppId` and c.isUse=1)
		WHERE a.`parentNode`=0
		<if test="ckAppId != null and ckAppId != ''">
			and a.ckAppId=#{ckAppId}
		</if>
		<if test="name != null and name != ''">
			and a.name='%${name}%'
		</if>
		GROUP BY a.`id`,a.`ckAppId`
	</select>
	
	<select id="get" resultType="Gift">
		SELECT *
		FROM t_gift a
		WHERE a.id = #{id} and ckAppId = #{ckAppId}
	</select>
	
	<select id="getSub" resultType="java.util.HashMap">
		SELECT *
		FROM t_gift a
		WHERE a.parentNode = #{parentNode} and a.ckAppId = #{ckAppId}
	</select>
	
	<select id="getDesc" resultType="java.lang.String">
		SELECT GROUP_CONCAT(b.`name`,'*',a.`goodsNumber`)  
		FROM t_gift a
		left join t_goods b on (a.ckAppId=b.ckAppId and a.goodsId=b.id)
		WHERE a.parentNode = #{parentNode} and a.ckAppId = #{ckAppId}
		group by parentNode
	</select>
</mapper>